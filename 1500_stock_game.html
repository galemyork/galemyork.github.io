<!doctype html>
<html lang="tr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Harca / Yatırım Oyunu — 1500 Hisse</title>
<style>
  :root{--bg:#0b1220;--card:#071226;--muted:#9aa4b2;--accent:#60a5fa}
  body{margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,Arial;background:linear-gradient(180deg,#021026,#07122a);color:#e6eef6}
  header{display:flex;align-items:center;gap:12px;padding:12px;border-bottom:1px solid rgba(255,255,255,0.02)}
  h1{margin:0;font-size:1rem}
  .wrap{display:flex;gap:12px;padding:12px;height:calc(100vh - 72px);box-sizing:border-box}
  .left{width:360px;min-width:260px;background:var(--card);border-radius:10px;padding:12px;border:1px solid rgba(255,255,255,0.03)}
  .main{flex:1;min-width:0;background:rgba(255,255,255,0.02);border-radius:10px;padding:8px;overflow:hidden;border:1px solid rgba(255,255,255,0.03)}
  .stat{color:var(--muted);font-size:13px;margin-bottom:6px}
  .controls{display:flex;gap:8px;margin-bottom:8px}
  button,input,select{font:inherit;padding:8px;border-radius:8px;border:0;background:#0f1724;color:#e6eef6;cursor:pointer}
  .btn{background:linear-gradient(90deg,#7dd3fc,#60a5fa);color:#06202a;font-weight:700;border:0}
  .danger{background:linear-gradient(90deg,#fb7185,#ef4444);}
  .list{height:calc(100vh - 160px);overflow:auto;padding:6px}
  .row{display:flex;align-items:center;gap:8px;padding:8px;border-radius:8px;margin-bottom:6px;background:rgba(255,255,255,0.01);}
  .sym{width:80px;font-weight:700;color:var(--accent)}
  .price{width:110px;text-align:right;font-family:monospace}
  .change{width:90px;text-align:right;font-family:monospace}
  .hold{width:80px;text-align:center}
  .tiny{font-size:12px;color:var(--muted)}
  .search{width:100%;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.02);background:transparent;color:var(--muted)}
  footer{color:var(--muted);font-size:12px;margin-top:8px;text-align:center}
  .green{color:#86efac} .red{color:#fb7185}
  @media (max-width:900px){.wrap{flex-direction:column}.left{width:100%}.list{height:40vh}}
</style>
</head>
<body>
<header>
  <h1>Para Harca / Yatırım Oyunu — 1500 Hisse</h1>
  <div style="margin-left:auto" class="tiny">Başlangıç: $100.00 • Hatasız aritmetik (kuruş bazlı)</div>
</header>

<div class="wrap">
  <aside class="left">
    <div class="stat"><strong>Fon</strong></div>
    <div style="font-size:22px;font-weight:700;margin-bottom:6px" id="funds">$100.00</div>
    <div class="stat">Portföy değeri: <span id="portfolio">$0.00</span></div>
    <div class="stat">Toplam net: <span id="net">$100.00</span></div>
    <div style="height:8px"></div>
    <div class="tiny">Hızlı işlemler</div>
    <div class="controls" style="flex-direction:column">
      <div style="display:flex;gap:8px">
        <button id="buyAll" class="btn">Tümünü Al (1 lot)</button>
        <button id="sellAll" class="btn danger">Tümünü Sat (1 lot)</button>
      </div>
      <div style="display:flex;gap:8px;margin-top:8px">
        <button id="reset" class="btn danger">Sıfırla</button>
        <button id="export" class="btn">Dışa Aktar</button>
      </div>
    </div>

    <hr style="border:0;border-top:1px solid rgba(255,255,255,0.02);margin:10px 0"/>

    <div class="tiny">Oyun ayarları</div>
    <div style="display:flex;gap:8px;margin-top:6px;align-items:center">
      <label class="tiny">Güncelle ms</label>
      <input id="interval" type="number" value="300" min="50" style="width:100px"/>
    </div>
    <div style="display:flex;gap:8px;margin-top:6px;align-items:center">
      <label class="tiny">Volatilite (0-1)</label>
      <input id="vol" type="number" min="0" max="1" step="0.01" value="0.25" style="width:100px"/>
    </div>

    <div style="height:8px"></div>
    <div class="tiny">Arama / Filtre</div>
    <input id="search" class="search" placeholder="Sembol veya ad ara..." />

    <footer>Not: 1 lot = 1 hisse. Satın alma = fon azalır, satma = fon artar.</footer>
  </aside>

  <main class="main">
    <div style="display:flex;gap:12px;align-items:center;margin-bottom:8px">
      <div class="tiny">Gösterilen: <span id="shown">1500</span></div>
      <div style="margin-left:auto" class="tiny">Canlı fiyatlar aralığı: $0.00 — $100.00</div>
    </div>
    <div style="display:flex;gap:8px;margin-bottom:8px">
      <button id="pause" class="btn">Duraklat</button>
      <button id="resume" class="btn">Devam</button>
      <div style="margin-left:auto" class="tiny">Tick: <span id="tick">0</span></div>
    </div>
    <div class="list" id="list" tabindex="0" aria-label="Hisse listesi">
      <!-- rows inserted here -->
    </div>
  </main>
</div>

<script>
/*
  Investment toy:
  - 1500 stocks (id 1..1500) with random names and symbols
  - Prices stored as integer cents to avoid float errors
  - Prices update via bounded random walk every interval ms
  - Buying 1 lot reduces funds by price; selling increases funds by price
  - Holdings tracked per symbol (integer shares)
  - All arithmetic done in cents; displayed as fixed 2 decimals
  - Export current state to JSON
*/

// Config
const STOCK_COUNT = 1500;
const INITIAL_FUNDS_CENTS = 10000; // $100.00
const MIN_PRICE_CENTS = 0;
const MAX_PRICE_CENTS = 10000; // $100.00

// State
let funds = INITIAL_FUNDS_CENTS;
let holdings = new Int32Array(STOCK_COUNT); // holdings per stock (0 initially)
let prices = new Int32Array(STOCK_COUNT); // current price in cents
let prevPrices = new Int32Array(STOCK_COUNT); // previous tick price for change display
let tick = 0;
let running = true;
let updateTimer = null;

// DOM refs
const fundsEl = document.getElementById('funds');
const portfolioEl = document.getElementById('portfolio');
const netEl = document.getElementById('net');
const particlesShownEl = document.getElementById('shown');
const listEl = document.getElementById('list');
const tickEl = document.getElementById('tick');
const pauseBtn = document.getElementById('pause');
const resumeBtn = document.getElementById('resume');
const intervalInp = document.getElementById('interval');
const volInp = document.getElementById('vol');
const searchInp = document.getElementById('search');
const buyAllBtn = document.getElementById('buyAll');
const sellAllBtn = document.getElementById('sellAll');
const resetBtn = document.getElementById('reset');
const exportBtn = document.getElementById('export');

// Utilities: cents formatting
function centsToStr(c){ const neg = c<0; c = Math.abs(c); const s = (c/100).toFixed(2); return (neg?'-':'')+'$'+s; }
function clamp(v,a,b){ return Math.max(a, Math.min(b, v)); }

// Generate random symbols & names deterministically (seeded)
const adjectives = ['Alpha','Beta','Gamma','Delta','Epsilon','Zeta','Theta','Sigma','Omicron','Nova','Quantum','Aero','Neo','Pico','Macro','Orion','Vega','Atlas','Lumen','Helix'];
const nouns = ['Systems','Industries','Holdings','Labs','Dynamics','Works','Enterprises','Solutions','Networks','Tech','Energy','Foods','Logistics','Motors','Pharma','Media','Textiles','Finance','Robotics','Construct'];

// Create stock metadata
const stocks = new Array(STOCK_COUNT);
for(let i=0;i<STOCK_COUNT;i++){
  const sym = ('S'+(100000+i)).slice(1); // S100000 etc -> keep unique
  const name = adjectives[i % adjectives.length] + ' ' + nouns[(i*7) % nouns.length] + ' ' + (i+1);
  stocks[i] = { id: i, symbol: sym, name };
}

// Initialize prices randomly between 0 and 100 dollars with cents precision
function initPrices(){
  for(let i=0;i<STOCK_COUNT;i++){
    const cents = Math.floor(Math.random() * (MAX_PRICE_CENTS + 1));
    prices[i] = cents;
    prevPrices[i] = cents;
  }
}
initPrices();

// Build list DOM once (rows)
const rows = new Array(STOCK_COUNT);
function buildList(){
  const frag = document.createDocumentFragment();
  for(let i=0;i<STOCK_COUNT;i++){
    const s = stocks[i];
    const row = document.createElement('div');
    row.className = 'row';
    row.dataset.index = i;
    row.innerHTML = `
      <div style="flex:1;min-width:0">
        <div style="display:flex;align-items:center;gap:8px">
          <div class="sym">${s.symbol}</div>
          <div style="min-width:0">
            <div style="font-weight:700;white-space:nowrap;overflow:hidden;text-overflow:ellipsis">${s.name}</div>
            <div class="tiny">${s.id+1}</div>
          </div>
        </div>
      </div>
      <div class="price" id="price-${i}">${centsToStr(prices[i])}</div>
      <div class="change" id="chg-${i}">+0.00%</div>
      <div class="hold" id="hold-${i}">0</div>
      <div style="display:flex;gap:4px">
        <button class="btn buy" data-i="${i}">Al</button>
        <button class="btn danger sell" data-i="${i}">Sat</button>
      </div>
    `;
    frag.appendChild(row);
    rows[i] = row;
  }
  listEl.appendChild(frag);
}
buildList();

// Price update: random walk with volatility parameter; prices in cents integers.
// We ensure rational-like precision by using integer cents; deltas are integer cents too.
function updatePrices(){
  const vol = parseFloat(volInp.value) || 0.25; // 0..1
  const maxStep = Math.max(1, Math.floor(MAX_PRICE_CENTS * vol * 0.02)); // step size proportional
  // We'll also occasionally apply a uniform random reset to ensure variety
  for(let i=0;i<STOCK_COUNT;i++){
    prevPrices[i] = prices[i];
    // random step between -maxStep and +maxStep, but can be fractional in cents? we keep integer cents
    const step = Math.floor(randInt(-maxStep, maxStep));
    let p = prices[i] + step;
    // occasional larger jitter 1% chance
    if(Math.random() < 0.01){
      p = Math.floor(Math.random() * (MAX_PRICE_CENTS + 1));
    }
    p = clamp(p, MIN_PRICE_CENTS, MAX_PRICE_CENTS);
    prices[i] = p;
  }
  tick++;
  tickEl.textContent = tick;
  refreshVisible();
}

// Random int function inclusive
function randInt(a,b){ return Math.floor(Math.random()*(b-a+1))+a; }

// Refresh visible UI (update price, change %, holdings)
function refreshVisible(){
  let portfolioCents = 0;
  for(let i=0;i<STOCK_COUNT;i++){
    const p = prices[i];
    const prev = prevPrices[i] || p;
    const priceEl = document.getElementById('price-'+i);
    const chgEl = document.getElementById('chg-'+i);
    const holdEl = document.getElementById('hold-'+i);
    if(priceEl) priceEl.textContent = centsToStr(p);
    if(chgEl){
      const percent = prev === 0 ? 0 : ((p - prev) / prev) * 100;
      const sign = percent >= 0 ? '+' : '';
      chgEl.textContent = sign + percent.toFixed(2) + '%';
      chgEl.className = 'change ' + (percent>=0 ? 'green' : 'red');
    }
    if(holdEl) holdEl.textContent = holdings[i];
    portfolioCents += holdings[i] * p;
  }
  portfolioEl.textContent = centsToStr(portfolioCents);
  const netCents = funds + portfolioCents;
  netEl.textContent = centsToStr(netCents);
  fundsEl.textContent = centsToStr(funds);
}

// Buying and selling 1 lot
function buyOne(i){
  const price = prices[i];
  if(funds < price){
    alert('Yetersiz fon.'); return false;
  }
  funds -= price;
  holdings[i] += 1;
  refreshVisible();
  return true;
}
function sellOne(i){
  if(holdings[i] <= 0){ alert('Bu hisseye sahip değilsin.'); return false; }
  const price = prices[i];
  holdings[i] -= 1;
  funds += price;
  refreshVisible();
  return true;
}

// Event delegation for buy/sell
listEl.addEventListener('click', function(e){
  const buyBtn = e.target.closest('button.buy');
  const sellBtn = e.target.closest('button.sell');
  if(buyBtn){
    const i = parseInt(buyBtn.dataset.i);
    buyOne(i);
  } else if(sellBtn){
    const i = parseInt(sellBtn.dataset.i);
    sellOne(i);
  }
});

// Search filter
searchInp.addEventListener('input', function(){
  const q = this.value.trim().toLowerCase();
  let shown = 0;
  for(let i=0;i<STOCK_COUNT;i++){
    const s = stocks[i];
    const row = rows[i];
    if(!q || s.symbol.toLowerCase().includes(q) || s.name.toLowerCase().includes(q) || String(s.id+1) === q){
      row.style.display = ''; shown++;
    } else row.style.display = 'none';
  }
  document.getElementById('shown').textContent = shown;
});

// Pause / resume
pauseBtn.addEventListener('click', ()=>{ running=false; if(updateTimer) clearInterval(updateTimer); });
resumeBtn.addEventListener('click', ()=>{ if(!running){ running=true; startUpdates(); } });

// Start updates respecting interval input
function startUpdates(){
  if(updateTimer) clearInterval(updateTimer);
  const ms = Math.max(50, parseInt(intervalInp.value) || 300);
  updateTimer = setInterval(()=>{ if(running) updatePrices(); }, ms);
  running = true;
}
startUpdates();

// Quick actions
buyAllBtn.addEventListener('click', ()=>{
  // buy 1 share of every visible stock (if funds sufficient)
  for(let i=0;i<STOCK_COUNT;i++){
    const row = rows[i];
    if(row.style.display === 'none') continue;
    const price = prices[i];
    if(funds >= price){
      funds -= price;
      holdings[i] += 1;
    }
  }
  refreshVisible();
});
sellAllBtn.addEventListener('click', ()=>{
  for(let i=0;i<STOCK_COUNT;i++){
    const row = rows[i];
    if(row.style.display === 'none') continue;
    if(holdings[i] > 0){
      funds += prices[i] * holdings[i];
      holdings[i] = 0;
    }
  }
  refreshVisible();
});
resetBtn.addEventListener('click', ()=>{
  if(!confirm('Oyun sıfırlansın mı?')) return;
  funds = INITIAL_FUNDS_CENTS;
  holdings.fill(0);
  initPrices();
  refreshVisible();
  tick = 0;
  tickEl.textContent = 0;
});
exportBtn.addEventListener('click', ()=>{
  const state = { funds, holdings: Array.from(holdings), prices: Array.from(prices), tick };
  const data = JSON.stringify(state);
  const blob = new Blob([data], {type:'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href = url; a.download = 'game_state.json'; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
});

// Initialize visible values
refreshVisible();

// Ensure arithmetic correctness: use integers (cents); no floats in funds/holdings changes beyond display formatting.

</script>
</body>
</html>
